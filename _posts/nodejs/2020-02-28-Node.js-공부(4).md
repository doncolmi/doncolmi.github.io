---
layout: post
title: Node.js(4) - Node.js의 모듈 개념
date: 2020-02-28 10:31:00 +0000
description: hello
img: nodejs.jpg
tags: [nodejs]
---



### 모듈

---

노드에서의 모듈이란 노드로 개발한 **애플리케이션을 이루는 기본 조각**이라고 할 수 있다.

즉 모듈이란, 물건을 만들 때 쓰는 부품이라 할 수 있는것이다. 무언가를 만들 때에 재료 하나로만 그것을 만들 수도 있지만, 조립식이라면 파트 하나하나를 만들어 끼워 만들 수도 있다는 것이다.

그런 물건들을 조립해서 완성품 하나를 만드는 것처럼, 관련된 코드를 모아 캡슐화 해놓은 것을 모듈이라고 한다. 그리고 여러가지 모듈을 이용하면 프로젝트를 훨씬 더 수월하게 진행할 수 있다.

<center><img src="/assets/img/nodejs/2020-02-28-Node.js-공부(4)/1.png"></center>

위 사진은 카메라 모듈이다. 렌즈, 렌즈 하우징, 이미지센서, 커넥터 라는 모듈로 카메라라는 완성품을 만드는 것이다.(저 카메라도 카메라 모듈이라 해서 핸드폰이라는 완성품을 만들기 위한 하나의 모듈이 된다...)

대충 이런 느낌이 모듈이란것만 알고가면 될 듯 하다.

일반적으로 노드로 개발된 애플리케이션은 객체 지향의 개념이 잘 녹아 있는 JS를 기반으로 하여, 파일과 1:1 맵핑이 되는 다양한 모듈로 구성된다. 노드를 개발할 때 개발자가 추가하는 모듈 뿐 아니라 **노드의 기능을 확장할 수 있도록 해주는 확장 모듈과 기본으로 제공하는 기능들에게도** 해당되는 이야기 이다.

### 노드의 모듈화 개념

---

노드는 **확장성을 위해** 모듈 구조로 애플리케이션을 구성하도록 하고 있다. 즉, **모듈은 애플리케이션을 이루는 기본 단위**이다. 보통 다수의 클래스와 이를 통해 생성한 객체로 구성된다.

이렇게 모듈 단위로 구성된다는 것은 **객체 지향 컨셉으로 애플리케이션이 구성**된다는 것을 의미한다. 이는 앞서 설명한대로 노드가 CommonJS의 스펙을 대부분 준수하기 때문이다.

<center><img src="/assets/img/nodejs/2020-02-28-Node.js-공부(4)/2.png"></center>
<center><small>CommonJS는 나중에 다른 글에서 다루겠다.</small></center>

기본적으로 노드의 모듈은 자바스크립트 파일 하나와 1:1로 매핑된다. 추후에 설명할 NPM으로 쉽게 할 수 있는 노드 확장 모듈의 개발을 편리하게 해주며, 실제 우리가 어플리케이션을 개발할 떄 소스 코드를 깔끔하게 구성할 수 있도록 해준다.

또한 위에 설명한 **CommonJS 모듈 스펙으로 부터 많은 영향을 받아 구현**되었지만 **완벽하게 동일 하지는 않다.**

많은 유사점이 있으며, CommonJS기반의 다른 시스템과 공유하고자 한다면 이 스펙에 대해 이해하고 있는 것이 도움이 될 것이다.

### 전역 객체의 개념

---

전역 객체는 어디에서나 사용할 수 있는 객체를 말한다. 예를 들어 클라이언트 자바 스크립트에선 **window** 나 **document**같은 것을 전역 객체라 할 수 있다.

<center><img src="/assets/img/nodejs/2020-02-28-Node.js-공부(4)/3.png"></center>

위 같은 전역 객체가 **서버 사이드에서 동작하는 노드**의 경우에는 **"global"**이라는 전역 객체가 존재하고 있는데, 여기에는 우리가 앞으로 모듈을 불러올 때 사용할 require()을 비롯해 setTimeout(), console.log() 등을 포함하고 있따.

아래 코드를 살펴보자

    require('./module')
    global.require('./module')

위 2줄은 같은의미다. **global**이라는 전역 객체가 **require()**를 가지고 있기에 두 표현 모두 가능한 것이다.

우리가 클라이언트 자바스크립트에서 `alert("하이")` 같이 창을 띄우고 싶을 때 `window.alert("하이")`이렇게 치는게 아닌것 처럼 global 또한 생략이 가능한 것이다.

### 모듈의 종류

---

노드에서 모듈의 종류를 크게 **노드 설치 시 기본적으로 설치되어 있는지에 대한 유무**를 통하여 **기본 모듈**과 **확장 모듈**로, 단순히 자바스크립트로 작성하였는지, C/C++ 등 다른 언어로 작성하고 빌드하여 개발 했는지에 따라 **일반모듈**과 **네이티브 모듈**로

그리고 지금 개발하는 것만을 위해 사용하기 위해 설치했는지에 따라 **글로벌 모듈**과 **로컬 모듈**정도로 분류할 수 있다. 각 모듈의 종류를 알고 있는 것이 개발하는 것에 중요한 영향을 미치는 것은 아니지만 모듈을 로딩하고 체계적으로 **NPM**을 배포하기 위해선 특징 정도는 알아두는것이 좋다.

<center><img src="/assets/img/nodejs/2020-02-28-Node.js-공부(4)/4.png"></center>

- 기본 모듈과 확장 모듈

    기본 모듈은 노드를 설치하면 처음부터 있는 모듈로써 **파일 입출력, 이벤트 관리, HTTP 프로토콜 관리**등에 관한 내용으로 비동기 입출력 처리를 위한 기본적인 기능을 제공하는 모듈이다.

    이에 비해 확장 모듈은 노드의 기능을 확장하기 위한 것으로써 좀 더 쉬운 HTTP 서버 생성, 기본 파일 입출력에서 제공하지 않는 기능 추가 등 노드를 확장하고 더 편리하게 사용하기 위한 모듈이다.

    확장 모듈은 나중에 소개할 express와 같은 모듈들처럼 하나의 프레임워크로서 제공되기도 하고, mongodb를 사용키 위한 mongoose나 mongolian 처럼 다른 기술을 손쉽게 끌어와 사용할 수 있게 도와주는 역할을 하기도 한다.

- 일반 모듈과 네이티브 모듈

    이는 개발 방법에 따라 나눌 수 있는 내용으로, 일반적으로 노드의 기본 모듈은 C/C++로 개발된 경우가 대부분이며 이렇게 네이티브 프로그래밍 언어인 C/C++로 노드의 모듈을 개발한 경우에 **네이티브 모듈** 이라고 한다.

    확장 모듈 또한 네이티브 모듈로 개발할 수 있으며, **.node**라는 확장자를 가졌으면 네이티브 모듈로 컴파일 된 것이라고 보면 된다.

    **같은 기능을 수행한다면 네이티브 모듈이 일반 모듈보단 더 나은 성능을 보여준다.**

- 글로벌 로듈과 로컬 모듈

    기본 모듈을 포함해 어디서든 사용할 수 있도록 설치한 확장 모듈을 글로벌 모듈이라고 한다면, 해당 어플리케이션에서만 사용하기 위해 설치한 확장 모듈이나 개발자가 개발한 모듈을 **로컬 모듈**이라고 분류할 수 있습니다. 확장 모듈을 글로벌 모듈로 사용하려면 설치 시 특별한 옵션(-g)를 이용하면 된다.

- 복합 모듈

    내부 모듈이나 데이터파일, 템플릿, 테스트 코드등을 포함하는 모듈을 말한다. 다양한 파일을 포함하기 때문에 모듈을 구성하는 단위가 폴더이며 내부적으로도 폴더를 가질 수 있다. require() 메소드가 이런 폴더 단위의 모듈을 인식하려면 index.js 파일이나 package.json 파일 중 하나가 반드시 있어야 한다.

### 그 외에

---

모듈의 이름은 확장자가 없는 __전체 경로를 사용_-한다. 앞서 설명한 것 처럼 모듈은 **파일과 일대일로 대응한다.** 그 때문에 .js나 .node라는 확장자를 가지지만 모듈을 불러들일 때는 파일 이름만 사용하면 되기 때문이다.

모듈의 식별자는 크게 상대적 식별자, 절대적 식별자, 그리고 최상위 레벨 식별자 등 3가지가 있다.

- 상대적 식별자

    현재 위치를 기준으로 상대적인 기준에 있는 모듈을 찾는 식별자이다. 유닉스 시스템의 상대 경로와 유사하나, **./를 생략하면 현재 위치에서 모듈을 찾지 않으니 주의하도록 하자.**

- 절대적 식별자

    절대적 식별자도 마찬가지로 절대 위치를 기준으로 그 경로에 맞는 모듈을 찾는 식별자이다. 유닉스 시스템의 절대 경로와 비슷하다.

- 최상위 레벨 식별자

    **아무것도 입력하지 않고 모듈 이름만 입력하면 최상위 레벨 식별자로 인식**하고 설치된 전체 확장 모듈이나 기본 모듈 이름을 검색해 로드한다.

    만약 `require('sample_module');`이라는 모듈을 로드한다고 하자.

    여기서 중요한점은 sample_module이라는 모듈 식별자를 찾는 순서이다. 만약 sample_module이 **기본 모듈에서 찾을 수 없는 모듈이면** **상위 디렉토리를 차례대로 탐색하게 된다**.

`/home/goorm/example_project/node_modules/sample_module.js`

`/home/goorm/example_project/sample_module.js`

`/home/node_modules/sample_module.js`

`/node_modules/sample_module.js`

위 순이다.

### require() 메소드와 module.exports

---

모듈 개념에서 **왜 require() 메소드와 module.exports 가 중요할까?**

먼저 클라이언트 측 자바스크립트와 비교해보자. 웹 브라우저의 HTML <script> 태그로 필요한 JS를 연결하고 호출하게 되어있다.

    <html>
    	<body>
    		<sciprt src="goorm1.js"></script>
    	</body>
    </html>
    <!-- 예제는 구름EDU에서 가져왔다. -->

이렇게 HTML 스크립트로 명시된 JS 파일들은 웹브라우저에 의해 로딩되며 서로 참조하거나 호출한다.

**그런데 노드는 HTML을 사용하지 않는다.**

그래서 서로 다른 JS 끼리 참조하고 호출하는 방법이 필요하다. 여기서 등장하는게 바로 require(), module.exports이다.

require()메소드는 모듈 식별자인 module.exports를 이용해 모듈이 제공하는 함수나 객체 등을 반환한다. 만약 불러온 모듈이 다른 모듈이 있어야 한다면 그 모듈도 같이 로드하도록 되어있다.

이것이 **노드 모듈화에서 핵심**이다.

노드에서 하나의 JS 파일은 하나의 모듈이 될 수 있다. 이때 JS 파일 내부에 함수나 변수를 module.exports에 할당하면 외부에서 접근할 수 있다.